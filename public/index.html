<script>
  document.getElementById('search-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const firstName = document.getElementById('first-name').value.trim();
    const lastName = document.getElementById('last-name').value.trim();

    const resultsDiv = document.getElementById('results');
    resultsDiv.style.display = 'none';
    resultsDiv.innerHTML = '';

    try {
      const res = await fetch(`https://ghl-nyfo-api.dennis-e64.workers.dev?first_name=${encodeURIComponent(firstName)}&last_name=${encodeURIComponent(lastName)}`);
      const data = await res.json();

      if (data.error) {
        resultsDiv.innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
      } else {
        // Contact Info Section
        const contactInfo = document.createElement('div');
        contactInfo.innerHTML = `
          <p><strong>Email:</strong> ${data.email || 'N/A'}</p>
          <p><strong>Phone:</strong> ${data.phone || 'N/A'}</p>
          <hr/>
        `;
        resultsDiv.appendChild(contactInfo);

        // Relationships Section
        if (Array.isArray(data.relationships) && data.relationships.length > 0) {
          const validRels = data.relationships.filter(rel => rel.relationship_type && rel.relationship_role);
          if (validRels.length > 0) {
            validRels.forEach(rel => {
              const relDiv = document.createElement('div');
              relDiv.innerHTML = `
                <strong>${rel.relationship_type.value}</strong> - ${rel.relationship_role.value}
              `;
              resultsDiv.appendChild(relDiv);
            });
          } else {
            resultsDiv.innerHTML += `<p>No valid relationships found.</p>`;
          }
        } else {
          resultsDiv.innerHTML += `<p>No relationships found.</p>`;
        }
      }

      resultsDiv.style.display = 'block';
    } catch (err) {
      resultsDiv.innerHTML = `<p style="color: red;">Error: ${err.message}</p>`;
      resultsDiv.style.display = 'block';
    }
  });
</script>
