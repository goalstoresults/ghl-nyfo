<!-- Add this section below your existing contact display -->

<hr>
<button id="toggleAddForm">+ Add Relationship</button>

<div id="addRelationshipForm" style="display:none; margin-top: 1em;">
  <h3>Add New Relationship</h3>
  <p><strong>Enter Related Contact Info</strong></p>
  <label>First Name:</label><br>
  <input type="text" id="relatedFirstName"><br>
  <label>Last Name:</label><br>
  <input type="text" id="relatedLastName"><br>
  <label>OR Email:</label><br>
  <input type="email" id="relatedEmail"><br><br>

  <label>Relationship Type:</label><br>
  <input type="text" id="relationshipType"><br>
  <label>Relationship Role:</label><br>
  <input type="text" id="relationshipRole"><br><br>

  <button id="saveRelationship">Save Relationship</button>
  <p id="saveStatus" style="color: green; margin-top: 1em;"></p>
</div>

<script>
// Toggle form visibility
document.getElementById("toggleAddForm").onclick = () => {
  const form = document.getElementById("addRelationshipForm");
  form.style.display = form.style.display === "none" ? "block" : "none";
};

// Save relationship
document.getElementById("saveRelationship").onclick = async () => {
  const relatedFirst = document.getElementById("relatedFirstName").value.trim();
  const relatedLast = document.getElementById("relatedLastName").value.trim();
  const relatedEmail = document.getElementById("relatedEmail").value.trim();
  const type = document.getElementById("relationshipType").value.trim();
  const role = document.getElementById("relationshipRole").value.trim();

  const data = {
    related_first: relatedFirst,
    related_last: relatedLast,
    related_email: relatedEmail,
    relationship_type: type,
    relationship_role: role,
    source_contact_id: window.currentContactId || null  // must be set from main search logic
  };

  const res = await fetch("https://ghl-nyfo-api.dennis-e64.workers.dev/save-relationship", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const json = await res.json();
  const status = document.getElementById("saveStatus");
  if (res.ok) {
    status.style.color = "green";
    status.textContent = "Relationship saved!";
  } else {
    status.style.color = "red";
    status.textContent = "Error: " + (json?.message || "Failed to save");
  }
};
</script>
