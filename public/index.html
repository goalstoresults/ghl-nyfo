<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Search Contact Relationships</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      padding: 40px;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      width: 500px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    .result {
      background: #f0f0ff;
      padding: 20px;
      margin-top: 20px;
      border-radius: 8px;
    }
    .error {
      color: red;
    }
    hr {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Search Contact Relationships</h2>
    <label>Email (preferred)</label>
    <input id="email" placeholder="someone@example.com" />
    <label>First Name</label>
    <input id="firstName" placeholder="Optional if email used" />
    <label>Last Name</label>
    <input id="lastName" placeholder="Optional if email used" />
    <button onclick="search()">Search</button>
    <div id="output" class="result"></div>
  </div>

  <script>
    async function search() {
      const email = document.getElementById("email").value.trim();
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const output = document.getElementById("output");
      output.innerHTML = '';

      const params = new URLSearchParams();
      if (email) {
        params.append("email", email);
      } else if (firstName && lastName) {
        params.append("first_name", firstName);
        params.append("last_name", lastName);
      } else {
        output.innerHTML = '<p class="error">Please enter either an email or both first and last names.</p>';
        return;
      }

      const url = `https://ghl-nyfo-api.dennis-e64.workers.dev/?${params.toString()}`;
      console.log("Fetching from:", url);

      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("Fetch failed");

        const data = await res.json();
        console.log("Response:", data);

        let html = `<strong>Email:</strong> ${data.email}<br/><strong>Phone:</strong> ${data.phone}<hr/>`;
        if (data.relationships.length > 0) {
          html += data.relationships.map(r => 
            `<strong>${r.related_to_name}</strong> - ${r.relationship_type} (${r.relationship_role})`
          ).join("<br/>");
        } else {
          html += "No relationships found.";
        }

        output.innerHTML = html;
      } catch (err) {
        console.error("Error fetching:", err);
        output.innerHTML = `<p class="error">Error: Failed to fetch</p>`;
      }
    }
  </script>
</body>
</html>
