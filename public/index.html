<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NYFO Contact Relationship Search Tool </title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8fb;
      padding: 2rem;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input {
      padding: 0.5rem;
      width: 100%;
      margin-bottom: 1rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      background: #275efe;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .section {
      margin-top: 2rem;
    }
    .divider {
      text-align: center;
      margin: 1rem 0;
      font-weight: bold;
      color: #555;
    }
    .result-box {
      background: #f0f0f5;
      padding: 1rem;
      border-radius: 6px;
    }
    .label {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>NYFO Contact Relationship Search Tool 44</h2>
    <p>Please enter either <strong>First &amp; Last Name</strong> or <strong>Email</strong>, not both.</p>
    <input id="firstName" placeholder="First Name" />
    <input id="lastName" placeholder="Last Name" />
    <div class="divider">— OR —</div>
    <input id="email" placeholder="Email" />
    <button onclick="searchContact()">Search</button>

    <div id="result" class="section result-box">
      Contact not found
    </div>

    <div class="section">
      <button id="addRelationshipBtn" style="display:none;" onclick="alert('Add Relationship not implemented yet')">Add Relationship</button>
    </div>
  </div>

  <script>
    async function searchContact() {
      const first = document.getElementById('firstName').value.trim();
      const last = document.getElementById('lastName').value.trim();
      const email = document.getElementById('email').value.trim();
      const resultDiv = document.getElementById('result');
      const addBtn = document.getElementById('addRelationshipBtn');
      addBtn.style.display = 'none';

      let query = '';
      if (email) {
        query = `?email=${encodeURIComponent(email)}`;
      } else if (first && last) {
        query = `?first=${encodeURIComponent(first)}&last=${encodeURIComponent(last)}`;
      } else {
        resultDiv.innerHTML = '<em>Please enter either email or both first and last name.</em>';
        return;
      }

      const url = `https://ghl-nyfo-api.dennis-e64.workers.dev/${query}`;
      resultDiv.innerHTML = `<em>Searching...</em>`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (data && data.success && data.result !== null) {
          const fullName = `${data.first_name ?? 'N/A'} ${data.last_name ?? ''}`.trim();
          const phone = data.phone ?? 'N/A';
          const email = data.email ?? 'N/A';

          resultDiv.innerHTML = `
            <div><span class="label">Name:</span> ${fullName || 'N/A'}</div>
            <div><span class="label">Email:</span> ${email}</div>
            <div><span class="label">Phone:</span> ${phone}</div>
            <br><em>No relationships found.</em>
          `;
          addBtn.style.display = 'inline-block';
        } else {
          resultDiv.innerHTML = `<strong>Contact not found</strong>`;
        }
      } catch (e) {
        resultDiv.innerHTML = `<strong>Error fetching contact</strong>`;
        console.error(e);
      }
    }
  </script>
</body>
</html>
